<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¼ë³¸ì·¨ì—… êµ¬ì¸ í”„ë¦¬ì…‹</title>
  <style>
    body{background:#0b0b0b;color:#fff;font-family:"Noto Sans KR",sans-serif;padding:22px}
    h1{margin:0 0 12px}
    .card{background:#111;border:1px solid rgba(255,255,255,0.12);border-radius:14px;padding:14px;margin:12px 0}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:10px 0}
    label{opacity:.85;font-weight:900}
    select,input,button{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.15);background:#121212;color:#fff;font-weight:900}
    input{min-width:260px}
    button{cursor:pointer;border:none}
    .primary{background:#1e7bff}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.15)}
    .hint{opacity:.7;font-size:12px;margin-top:6px}
    #msg{margin-top:12px;opacity:.85}
  </style>
</head>
<body>

<h1>ğŸ‡¯ğŸ‡µ ì¼ë³¸ì·¨ì—… êµ¬ì¸ (Indeed RSS)</h1>

<div class="card">
  <div class="row">
    <label>í”„ë¦¬ì…‹</label>
    <select id="preset" onchange="onPresetChange()"></select>
    <button class="ghost" onclick="refresh()">ìƒˆë¡œê³ ì¹¨</button>
  </div>

  <div class="row">
    <label>ì»¤ìŠ¤í…€ q</label>
    <input id="q" placeholder="ì˜ˆ: software engineer english" />
  </div>
  <div class="row">
    <label>ì»¤ìŠ¤í…€ l</label>
    <input id="l" placeholder="ì˜ˆ: Tokyo / Japan" />
  </div>
  <div class="hint">í”„ë¦¬ì…‹ì´ â€œì»¤ìŠ¤í…€â€ì¼ ë•Œë§Œ q/lì´ ì ìš©ë©ë‹ˆë‹¤.</div>
</div>

<div class="card">
  <div class="row">
    <label>í‘œì‹œ ê°œìˆ˜</label>
    <select id="count">
      <option value="3">3ê°œ</option>
      <option value="5">5ê°œ</option>
      <option value="8">8ê°œ</option>
      <option value="10">10ê°œ</option>
    </select>

    <label>ìë™ ë¡¤ë§</label>
    <select id="roll">
      <option value="true">ON</option>
      <option value="false">OFF</option>
    </select>

    <label>ë¡¤ë§ ê°„ê²©</label>
    <select id="interval">
      <option value="5">5ì´ˆ</option>
      <option value="10">10ì´ˆ</option>
      <option value="15">15ì´ˆ</option>
      <option value="20">20ì´ˆ</option>
      <option value="30">30ì´ˆ</option>
    </select>
  </div>

  <div class="row">
    <button class="primary" onclick="save()">ì €ì¥ & ì¦‰ì‹œ ê°±ì‹ </button>
  </div>
  <div id="msg">ë¡œë”©ì¤‘...</div>
</div>

<script>
let currentCfg = null;

function onPresetChange(){
  const preset = document.getElementById("preset").value;
  const q = document.getElementById("q");
  const l = document.getElementById("l");
  const enabled = (preset === "custom");
  q.disabled = !enabled;
  l.disabled = !enabled;
}

async function refresh(){
  const res = await fetch("/api/jobsjp/presets");
  const data = await res.json();

  currentCfg = data.current;

  const sel = document.getElementById("preset");
  sel.innerHTML = "";
  (data.presets || []).forEach(p => {
    const opt = document.createElement("option");
    opt.value = p.key;
    opt.textContent = p.name;
    sel.appendChild(opt);
  });

  sel.value = currentCfg.preset || "custom";

  document.getElementById("q").value = (currentCfg.custom?.q || "");
  document.getElementById("l").value = (currentCfg.custom?.l || "");

  document.getElementById("count").value = String(currentCfg.ui?.count ?? 6);
  document.getElementById("roll").value = String(!!(currentCfg.ui?.roll ?? true));
  document.getElementById("interval").value = String(currentCfg.ui?.interval ?? 10);

  onPresetChange();
  document.getElementById("msg").innerText = "âœ… ë¡œë“œ ì™„ë£Œ";
}

async function save(){
  const preset = document.getElementById("preset").value;

  const body = {
    preset,
    custom: {
      q: document.getElementById("q").value.trim(),
      l: document.getElementById("l").value.trim(),
    },
    ui: {
      count: Number(document.getElementById("count").value),
      roll: document.getElementById("roll").value === "true",
      interval: Number(document.getElementById("interval").value),
    }
  };

  await fetch("/api/jobsjp/config", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(body)
  });

  document.getElementById("msg").innerText = "âœ… ì €ì¥ ì™„ë£Œ (ì˜¤ë²„ë ˆì´ 5ì´ˆ ë‚´ ë°˜ì˜)";
}

refresh();
</script>

</body>
</html>
