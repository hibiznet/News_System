<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í•´ì™¸ì·¨ì—… êµ¬ì¸ ì†ŒìŠ¤</title>
  <style>
    body{background:#0b0b0b;color:#fff;font-family:"Noto Sans KR",sans-serif;padding:22px}
    h1{margin:0 0 12px}
    .card{background:#111;border:1px solid rgba(255,255,255,0.12);border-radius:14px;padding:14px;margin:12px 0}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:10px 0}
    label{opacity:.85;font-weight:900}
    select,button{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.15);background:#121212;color:#fff;font-weight:900}
    button{cursor:pointer;border:none}
    .primary{background:#1e7bff}
    .ghost{background:transparent;border:1px solid rgba(255,255,255,0.15)}
    .hint{opacity:.7;font-size:12px;margin-top:6px}
    #msg{margin-top:12px;opacity:.85}
  </style>
</head>
<body>

<h1>ğŸŒ í•´ì™¸ì·¨ì—… êµ¬ì¸(ì¼ë³¸) ì†ŒìŠ¤</h1>
<div class="hint">Indeed ì œê±° â†’ TokyoDev/Japan Devë¡œ ì¦‰ì‹œ ìš´ì˜ ê°€ëŠ¥</div>

<div class="card">
  <div class="row">
    <label>ì†ŒìŠ¤</label>
    <select id="source" onchange="onSourceChange()"></select>

    <label>í”„ë¦¬ì…‹</label>
    <select id="preset"></select>

    <button class="ghost" onclick="refresh()">ìƒˆë¡œê³ ì¹¨</button>
  </div>
</div>

<div class="card">
  <div class="row">
    <label>í‘œì‹œ ê°œìˆ˜</label>
    <select id="count">
      <option value="1">1</option>
      <option value="3">3</option>
      <option value="5">5</option>
      <option value="8">8</option>
      <option value="10">10</option>
    </select>

    <label>ìë™ ë¡¤ë§</label>
    <select id="roll">
      <option value="true">ON</option>
      <option value="false">OFF</option>
    </select>

    <label>ê°„ê²©(ì´ˆ)</label>
    <select id="interval">
      <option value="10">10</option>
      <option value="20">20</option>
      <option value="30">30</option>
      <option value="60">60</option>
      <option value="120">120</option>
    </select>

    <button class="primary" onclick="save()">ì €ì¥ & ì¦‰ì‹œ ê°±ì‹ </button>
  </div>

  <div id="msg">ë¡œë”©ì¤‘...</div>
</div>

<script>
let sourcesData = [];
let currentCfg = null;

function fillSourceSelect() {
  const sel = document.getElementById("source");
  sel.innerHTML = "";
  sourcesData.forEach(s => {
    const opt = document.createElement("option");
    opt.value = s.key;
    opt.textContent = s.name;
    sel.appendChild(opt);
  });
}

function fillPresetSelect(sourceKey) {
  const presetSel = document.getElementById("preset");
  presetSel.innerHTML = "";
  const src = sourcesData.find(s => s.key === sourceKey);
  (src?.presets || []).forEach(p => {
    const opt = document.createElement("option");
    opt.value = p.key;
    opt.textContent = p.name;
    presetSel.appendChild(opt);
  });
}

function onSourceChange(){
  const sourceKey = document.getElementById("source").value;
  fillPresetSelect(sourceKey);
}

async function refresh(){
  const res = await fetch("/api/jobsjp/presets");
  const data = await res.json();

  sourcesData = data.sources || [];
  currentCfg = data.current || {};

  fillSourceSelect();

  document.getElementById("source").value = currentCfg.source || sourcesData[0]?.key || "tokyodev";
  fillPresetSelect(document.getElementById("source").value);

  document.getElementById("preset").value = currentCfg.preset || document.getElementById("preset").options[0]?.value;

  document.getElementById("count").value = String(currentCfg.ui?.count ?? 10);
  document.getElementById("roll").value = String(!!(currentCfg.ui?.roll ?? true));
  document.getElementById("interval").value = String(currentCfg.ui?.interval ?? 30);

  document.getElementById("msg").innerText = "âœ… ë¡œë“œ ì™„ë£Œ";
}

async function save(){
  const body = {
    source: document.getElementById("source").value,
    preset: document.getElementById("preset").value,
    ui: {
      count: Number(document.getElementById("count").value),
      roll: document.getElementById("roll").value === "true",
      interval: Number(document.getElementById("interval").value),
    }
  };

  await fetch("/api/jobsjp/config", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(body)
  });

  document.getElementById("msg").innerText = "âœ… ì €ì¥ ì™„ë£Œ (ì˜¤ë²„ë ˆì´ 5ì´ˆ ë‚´ ë°˜ì˜)";
}

refresh();
</script>

</body>
</html>
